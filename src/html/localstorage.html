{% extends './base.html' %}

{% block title %}localStorage{% endblock %}

{% block content %}
  <div class="container">
    <h1>
      <span class="uppercase">localStorage</span>
      <small>Support + Capacity</small>
    </h1>

    <div class="results">
      <hr>
      <h2>Results for Your Browser</h2>
      <p><b>Your User Agent:</b> <span class="user-agent"></span></p>
      <p>
        <a class="btn btn-small btn-primary" href="?capacity">With Capacity Test</a>
        <a class="btn btn-small" href="?">Without Capacity Test</a>
      </p>
      <p>
        <span class="label result-pass">Pass</span>
        <span class="label result-fail">Fail</span>
        <span class="label result-error">Error</span>
      </p>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Test</th>
            <th>Result</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <hr>
    <h2>Known Results</h2>
    <p>Previous results generated by this page.</p>

    <div class="it-is-known">
      <h3>Browser/Platform Key</h3>
      <div class="row">
        <div class="span6">
          <ul>
            <li><b><i class="fa fa-globe"></i></b> Browser</li>
            <li><b><i class="fa fa-desktop"></i></b> Platform</li>
            <li><b><i class="fontelico-chrome"></i></b> Chrome</li>
            <li><b><i class="fontelico-firefox"></i></b> Firefox</li>
            <li><b><i class="fa fa-compass"></i></b> Safari</li>
          </ul>
        </div>
        <div class="span6">
          <ul>
            <li><b><i class="fontelico-ie"></i></b> IE</li>
            <li><b><i class="fontelico-opera"></i></b> Opera</li>
            <li><b><i class="fa fa-apple"></i></b> OS X</li>
            <li><b><i class="fa fa-apple"></i><i class="fa fa-mobile"></i></b> iOS</li>
            <li><b><i class="fa fa-windows"></i></b> Windows</li>
          </ul>
        </div>
      </div>

      <h3>Feature Key</h3>
      <div class="row">
        <div class="span6">
          <ul>
            <li><b><i class="fa fa-eye"></i></b> Private Browsing Mode</li>
            <li><b><i class="fa fa-ban"></i></b> Storage Disabled</li>
            <li><b>!!</b> <code>!!localStorage</code></li>
            <li><b>tof</b> <code>typeof localStorage</code></li>
            <li><b>toS</b> <code>localSorage.toString()</code></li>
            <li><b>in w</b> <code>'localStorage' in window</code></li>
            <li><b>set</b> <code>localStorage.setItem()</code></li>
          </ul>
        </div>
        <div class="span6">
          <ul>
            <li><b>get</b> <code>localStorage.getItem()</code></li>
            <li><b>rem</b> <code>localStorage.removeItem()</code></li>
            <li><b>clr</b> <code>localStorage.clear()</code></li>
            <li><b>key</b> <code>localStorage.key()</code></li>
            <li><b>len</b> <code>localStorage.length</code></li>
            <li><b>[]</b> Iterating as an array.</li>
            <li><b>{}</b> Iterating as an object.</li>
          </ul>
        </div>
      </div>

      <h3>Results</h3>
      <table class="table table-bordered table-hover">
        {% include './localstorage-header.html' %}

        <tbody>
          {% set browser = null %}
          {% set browser_version = null %}

          {% for result in results %}
            {% set browser_changed = result.browser != browser and browser != null %}
            {% set browser_version_changed = result.browser_version != browser_version and browser_version != null %}
            {% if browser_changed or browser_version_changed %}
              </tbody>
            {% endif %}

            {% if headerIndexes.indexOf(loop.index0) > -1 %}
              {% include './localstorage-header.html' %}
            {% endif %}

            {% if browser_changed or browser_version_changed %}
              <tbody>
            {% endif %}
            {% set browser = result.browser %}
            {% set browser_version = result.browser_version %}

            {% autoescape false %}
              <tr class="{{ result.class_name }}">
                <td>{{ result.browser }}</td>
                <td>{{ result.browser_version }}</td>
                <td>{{ result.platform }}</td>
                <td>{{ result.platform_version }}</td>
                <td>{{ result.private }}</td>
                <td>{{ result.storage_disabled }}</td>
                <td>{{ result.double_not }}</td>
                <td>{{ result.typeof }}</td>
                <td>{{ result.tostring }}</td>
                <td>{{ result.in_window }}</td>
                <td>{{ result.setitem }}</td>
                <td>{{ result.getitem }}</td>
                <td>{{ result.removeitem }}</td>
                <td>{{ result.clear }}</td>
                <td>{{ result.key }}</td>
                <td>{{ result.length }}</td>
                <td>{{ result.as_array }}</td>
                <td>{{ result.as_object }}</td>
                <td>{{ result.capacity }}</td>
              </tr>
            {% endautoescape %}
          {% endfor %}
        </tbody>
      </table>
    </div>

    <hr>
    <h2>TODO</h2>
    <ul>
      <li>IE11, Android, Windows 8 Mobile.</li>
      <li>Webviews on mobile.</li>
    </ul>

    <hr>
    <h2>Notes</h2>
    <ul>
      <li>Iteration order is not guaranteed, just like a normal JavaScript object.</li>
      <li>For all forced error cases in Safari 6.0.5 on OS X when in private browsing mode, a <code>QUOTA_EXCEEDED_ERR</code> is thrown. <code>setItem()</code>, <code>clear()</code>, and <code>key()</code> throw this error, while <code>getItem()</code> always returns <code>null</code> and <code>length</code> is always 0.</li>
      <li>So far, Safari is the only browser that blocks access when in private browsing mode.</li>
      <li>Both Safari and IE allow access when cookies are disabled.</li>
      <li>IE has separate settings for disabling cookies and DOM storage.</li>
      <li>IE8 throws a <code>TypeError</code> when calling <code>toString()</code>, but is fine if you cast to a string via <code>+ ''</code>.</li>
      <li>The capacity test crashes Safari 6.1 on OS X 10.8. The result is reported but the browser becomes unresponsive.</li>
      <li>Safari >= 6.1 on OS X and iOS blocks access both in private browsing mode and when cookies are disabled.</li>
      <li>There is no way to block access on Chrome for iOS.</li>
    </ul>

    <hr>
    <h2>Log Output</h2>
    <ul class="log"></ul>
  </div>
{% endblock %}

{% block js %}
  <script src="js/jquery.js"></script>
  <script src="js/localstorage.js"></script>
{% endblock %}
