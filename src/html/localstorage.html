{% extends './base.html' %}

{% block title %}localStorage{% endblock %}

{% block content %}
  <div class="container">
    <h1>
      <span class="uppercase">localStorage</span>
      <small>Support + Capacity</small>
    </h1>

    <div class="results">
      <hr>
      <h2>Results for Your Browser</h2>
      <p><b>Your User Agent:</b> <span class="user-agent"></span></p>
      <p>
        <a class="btn btn-small btn-primary" href="?capacity">With Capacity Test</a>
        <a class="btn btn-small" href="?">Without Capacity Test</a>
      </p>
      <p>
        <span class="label result-pass">Pass</span>
        <span class="label result-fail">Fail</span>
        <span class="label result-error">Error</span>
      </p>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>Test</th>
            <th>Result</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <hr>
    <h2>Known Results</h2>
    <p>Previous results generated by this page.</p>

    <h3>Browser Key</h3>
    <p>TODO</p>

    <h3>Feature Key</h3>
    <div class="it-is-known">
      <div class="row">
        <div class="span6">
          <ul>
            <li><b><i class="fa fa-eye"></i></b> Private Browsing Mode</li>
            <li><b><i class="fa fa-ban"></i></b> Storage Disabled</li>
            <li><b>!!</b> <code>!!localStorage</code></li>
            <li><b>tof</b> <code>typeof localStorage</code></li>
            <li><b>toS</b> <code>localSorage.toString()</code></li>
            <li><b>in w</b> <code>'localStorage' in window</code></li>
            <li><b>set</b> <code>localStorage.setItem()</code></li>
          </ul>
        </div>
        <div class="span6">
          <ul>
            <li><b>get</b> <code>localStorage.getItem()</code></li>
            <li><b>rem</b> <code>localStorage.removeItem()</code></li>
            <li><b>clr</b> <code>localStorage.clear()</code></li>
            <li><b>key</b> <code>localStorage.key()</code></li>
            <li><b>len</b> <code>localStorage.length</code></li>
            <li><b>[]</b> Iterating as an array.</li>
            <li><b>{}</b> Iterating as an object.</li>
          </ul>
        </div>
      </div>

      <h3>Results</h3>
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <th>Browser</th>
            <th>Version</th>
            <th>Platform</th>
            <th>Version</th>
            <th><i class="fa fa-eye"></i></th>
            <th><i class="fa fa-ban"></i></th>
            <th>!!</th>
            <th>tof</th>
            <th>toS</th>
            <th>in w</th>
            <th>set</th>
            <th>get</th>
            <th>rem</th>
            <th>clr</th>
            <th>key</th>
            <th>len</th>
            <th>[]</th>
            <th>{}</th>
            <th>Capacity</th>
          </tr>
        </thead>

        <tbody>
          {% set browser = null %}
          {% set browser_version = null %}

          {% for result in results %}
            {% if result.browser != browser and browser != null %}
              </tbody>
              <tbody>
            {% endif %}
            {% set browser = result.browser %}

            <tr>
              <td>{{ result.browser }}</td>
              <td>{{ result.browser_version }}</td>
              <td>{{ result.platform }}</td>
              <td>{{ result.platform_version }}</td>
              <td>{{ result.private }}</td>
              <td>{{ result.storage_disabled }}</td>
              <td>{{ result.double_not }}</td>
              <td>{{ result.typeof }}</td>
              <td>{{ result.tostring }}</td>
              <td>{{ result.in_window }}</td>
              <td>{{ result.setitem }}</td>
              <td>{{ result.getitem }}</td>
              <td>{{ result.removeitem }}</td>
              <td>{{ result.clear }}</td>
              <td>{{ result.key }}</td>
              <td>{{ result.length }}</td>
              <td>{{ result.as_array }}</td>
              <td>{{ result.as_object }}</td>
              <td>{{ result.capacity }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <hr>
    <h2>Things to Investigate</h2>
    <ul>
      <li>Determine localStorage supported vs. disabled vs. private browsing vs. quota full.</li>
      <li>What errors other than <code>QUOTA_EXCEEDED_ERR</code> can get thrown?</li>
      <li>IE11, iOS, Android, Windows 8 Mobile</li>
    </ul>

    <hr>
    <h2>Notes</h2>
    <ul>
      <li>Iteration order is not guaranteed, just like a normal JavaScript object.</li>
      <li>For all forced error cases in Chrome (31 on OS X), Firefox (25 on OS X), and Opera (17 on OS X) when cookies are disabled, a <code>SecurityError</code> is thrown.</li>
      <li>For all forced error cases in Safari (6.0.5 on OS X) when in private browsing mode, a <code>QUOTA_EXCEEDED_ERR</code> is thrown. <code>setItem()</code>, <code>clear()</code>, and <code>key()</code> throw this error, while <code>getItem()</code> always returns <code>null</code> and <code>length</code> is always 0.</li>
      <li>So far, Safari is the only browser that blocks access when in private browsing mode.</li>
      <li>Both Safari and IE allow access when cookies are disabled.</li>
      <li>IE has separate settings for disabling cookies and DOM storage.</li>
      <li><code>localStorage === null</code> in IE (8/9/10) when DOM storage is disabled.</li>
      <li>IE8 throws a <code>TypeError</code> when calling <code>toString()</code>, but is fine if you cast to a string via <code>+ ''</code>.</li>
    </ul>

    <hr>
    <h2>Log Output</h2>
    <ul class="log"></ul>
  </div>
{% endblock %}

{% block js %}
  <script src="js/jquery.js"></script>
  <script src="js/localstorage.js"></script>
{% endblock %}
